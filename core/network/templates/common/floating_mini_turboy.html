{% load profile_extra %}


<div
   x-data="{ 
    
    position: $persist({ x: 20, y: 120 }),
    isDragging: false,
    dragStart: { x: 0, y: 0 },
    startDrag(e) {
      this.isDragging = true;
      const touch = e.touches ? e.touches[0] : e;
      this.dragStart.x = touch.clientX - this.position.x;
      this.dragStart.y = touch.clientY - this.position.y;
      this.$el.style.transition = 'none';
    },
    
    drag(e) {
      if (!this.isDragging) return;
      e.preventDefault();
      const touch = e.touches ? e.touches[0] : e;
      this.position.x = touch.clientX - this.dragStart.x;
      this.position.y = touch.clientY - this.dragStart.y;
      
      // Constrain to screen bounds
      const rect = this.$el.getBoundingClientRect();
      this.position.x = Math.max(10, Math.min(window.innerWidth - rect.width - 10, this.position.x));
      this.position.y = Math.max(10, Math.min(window.innerHeight - rect.height - 10, this.position.y));
    },
    
    endDrag() {
      if (!this.isDragging) return;
      this.isDragging = false;
      this.$el.style.transition = 'all 0.3s ease';
      
    },
    
    openFullTurboy() {
      if (!this.isDragging) {
        showTurboy = true;
        showMiniTurboy = false;
      }
    },
    closeFullTurboy() {
      showTurboy = false;
      showMiniTurboy = true;
    }
  }">

  <!-- Floating Mini Turboy Console (Mobile/Tablet Only) -->

<div 
  id="floating-mini-turboy"
  class="block lg:hidden floating-mini-turboy fixed z-50 cursor-grab"
  x-show="showMiniTurboy"
 
  :style="`left: ${position.x}px; top: ${position.y}px;`"
  @mousedown="startDrag"
  @mousemove="drag"
  @mouseup="endDrag"
  @touchstart="startDrag"
  @touchmove="drag" 
  @touchend="endDrag"
  @click="openFullTurboy"
  style="font-family: 'Press Start 2P', monospace; font-size: 6px; cursor: grab;"
  :style="isDragging && { cursor: 'grabbing' }"
>

  <!-- Circular Mini Console Container -->
  <div class="mini-turboy-circle w-16 h-16 rounded-full relative overflow-hidden"
       :class="{ 'mini-turboy-dragging': isDragging }">
      
      <!-- Mini Console Header -->
      <div class="mini-console-header absolute top-1 left-0 right-0 text-center">
        <div class="mini-title text-[4px] font-bold tracking-wider text-cyan-400"
            style="text-shadow: 0 0 3px currentColor;">
          TUR-BOY
        </div>
      </div>
      
      <!-- Mini Underwater Screen -->
      <div class="mini-underwater-screen absolute top-3 left-2 right-2 bottom-4 rounded-sm overflow-hidden">
        <div class="mini-screen-environment h-full relative">
          {% if user.is_authenticated %}
            <!-- Mini Turtle Avatar -->
            <img src="/media/defaults/turtle_sunbathing.gif" 
                class="mini-turtle-avatar w-3 h-3 absolute top-1 left-1"
                style="image-rendering: pixelated;">
            
            <!-- Mini Underwater Elements -->
            <div class="mini-coral absolute bottom-0 right-1 text-[6px] opacity-60">ðŸª¸</div>
            <div class="mini-kelp absolute top-0 right-0 text-[6px] opacity-60">ðŸŒ¿</div>
            
            <!-- Mini Bubble -->
            <div class="mini-bubble absolute top-2 right-2 w-1 h-1 rounded-full border border-blue-400 opacity-40"></div>
          {% else %}
            <!-- Not Connected State -->
            <div class="flex justify-center items-center h-full">
              <img class="w-2 h-2" src="/media/defaults/red_dots.gif" alt="Disconnected">
            </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Mini Status Indicators -->
      <div class="mini-status-dots absolute bottom-1 left-1 right-1 flex justify-center gap-0.5">
        {% if user.is_authenticated %}
          <div class="status-dot-active w-1 h-1 rounded-full bg-cyan-400" 
              style="box-shadow: 0 0 2px currentColor;"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
        {% else %}
          <div class="status-dot w-1 h-1 rounded-full bg-red-500 opacity-60"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
        {% endif %}
      </div>
    </div>
    
    <!-- Floating Animation Glow Ring -->
    <div class="mini-glow-ring absolute inset-0 rounded-full pointer-events-none"></div>
  </div> <!-- ENd of Floating Mini Turboy Console  -->


  <!-- Full turboy -->
  <div
    x-show="showTurboy" 
    x-cloak
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50"
    @keydown.escape.window="closeFullTurboy"
  >
    <div class="py-12 xs:px-4 md:px-12 mx-auto max-w-2xl overflow-y-hidden">

      {% include 'posts/partial/turboy.html' with in_modal=True %}
    </div>
  </div>   <!-- End of full turboy -->


</div> <!-- End of mini & full turboy container -->






<style>
/* Floating Mini Turboy - Holographic Design System Integration */


/* Circular Mini Console - Reusing your holographic glass system */
.mini-turboy-circle {
  /* Your signature diving console styling */
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(6, 182, 212, 0.3);
  box-shadow: 
    0 8px 25px rgba(0, 0, 0, 0.3),
    inset 0 2px 4px rgba(255, 255, 255, 0.05), 
    0 0 30px rgba(6, 182, 212, 0.1);
  
  /* Gentle floating animation - reusing your turtle-float */
  animation: mini-turtle-float 6s ease-in-out infinite;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Holographic bezel glow - adapted from your console */
.mini-turboy-circle::before {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: inherit;
  padding: 1px;
  background: linear-gradient(135deg, 
    rgba(6, 182, 212, 0.4) 0%,
    transparent 25%,
    transparent 75%,
    rgba(16, 185, 129, 0.4) 100%
  );
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: exclude;
  animation: mini-bezel-glow 4s ease-in-out infinite;
  pointer-events: none;
}

/* Mini screen environment - your underwater styling */
.mini-screen-environment {
  background: 
    radial-gradient(ellipse at center top, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
    radial-gradient(ellipse at center bottom, rgba(16, 185, 129, 0.05) 0%, transparent 50%),
    rgba(0, 0, 0, 0.6);
  border: 1px solid rgba(6, 182, 212, 0.2);
  border-radius: 2px;
}

/* Hover states - your signature interactive glow */
.floating-mini-turboy:hover .mini-turboy-circle {
  border-color: rgba(6, 182, 212, 0.5);
  box-shadow: 
    0 12px 35px rgba(0, 0, 0, 0.4),
    0 0 40px rgba(6, 182, 212, 0.2),
    inset 0 2px 4px rgba(255, 255, 255, 0.1);
  transform: scale(1.05);
}

/* Dragging state */
.mini-turboy-dragging {
  transform: scale(1.1) !important;
  box-shadow: 
    0 15px 40px rgba(0, 0, 0, 0.5),
    0 0 50px rgba(6, 182, 212, 0.3) !important;
}

/* Floating animations - adapted from your existing keyframes */
@keyframes mini-turtle-float {
  0%, 100% { 
    transform: translate(0px, 0px) rotate(0deg); 
  }
  25% { 
    transform: translate(2px, -3px) rotate(-1deg); 
  }
  50% { 
    transform: translate(0px, -5px) rotate(0deg); 
  }
  75% { 
    transform: translate(-2px, -2px) rotate(1deg); 
  }
}

@keyframes mini-bezel-glow {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* Mini glow ring - subtle pulsing effect */
.mini-glow-ring {
  background: radial-gradient(circle, rgba(6, 182, 212, 0.1) 0%, transparent 70%);
  animation: mini-glow-pulse 3s ease-in-out infinite;
}

@keyframes mini-glow-pulse {
  0%, 100% { opacity: 0.3; transform: scale(1); }
  50% { opacity: 0.6; transform: scale(1.1); }
}
</style>
