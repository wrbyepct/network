{% load profile_extra %}


<div
   x-data="{ 
    
    position: $persist({ x: 20, y: 120 }),
    isDragging: false,
    dragStart: { x: 0, y: 0 },
    startDrag(e) {
      this.isDragging = true;
      const touch = e.touches ? e.touches[0] : e;
      this.dragStart.x = touch.clientX - this.position.x;
      this.dragStart.y = touch.clientY - this.position.y;
      this.$el.style.transition = 'none';
    },
    
    drag(e) {
      if (!this.isDragging) return;
      e.preventDefault();
      const touch = e.touches ? e.touches[0] : e;
      this.position.x = touch.clientX - this.dragStart.x;
      this.position.y = touch.clientY - this.dragStart.y;
      
      // Constrain to screen bounds
      const rect = this.$el.getBoundingClientRect();
      this.position.x = Math.max(10, Math.min(window.innerWidth - rect.width - 10, this.position.x));
      this.position.y = Math.max(10, Math.min(window.innerHeight - rect.height - 10, this.position.y));
    },
    
    endDrag() {
      if (!this.isDragging) return;
      this.isDragging = false;
      this.$el.style.transition = 'all 0.3s ease';
      
    },
    
    openFullTurboy() {
      if (!this.isDragging) {
        showTurboy = true;
        showMiniTurboy = false;
      }
    },
    closeFullTurboy() {
      showTurboy = false;
      showMiniTurboy = true;
    }
  }">

  <!-- Floating Mini Turboy Console (Mobile/Tablet Only) -->

<div 
  id="floating-mini-turboy"
  class="block lg:hidden holo-console-interactive fixed z-50 cursor-grab rounded-full transition ease-in-out"
  x-show="showMiniTurboy"
 
  :style="`left: ${position.x}px; top: ${position.y}px;`"
  @mousedown="startDrag"
  @mousemove="drag"
  @mouseup="endDrag"
  @touchstart="startDrag"
  @touchmove="drag" 
  @touchend="endDrag"
  @click="openFullTurboy"
  style="font-family: 'Press Start 2P', monospace; font-size: 6px; cursor: grab;"
  :style="isDragging && { cursor: 'grabbing' }"
>

  <!-- Circular Mini Console Container -->
  <div class="holo-mini-console w-16 h-16 rounded-full"
       :class="{ 'holo-console-dragging': isDragging }">
      
      <!-- Mini Console Header -->
      <div class="mini-console-header absolute top-1 left-0 right-0 text-center">
        <div class="mini-title text-[4px] font-bold tracking-wider text-cyan-400"
            style="text-shadow: 0 0 3px currentColor;">
          TUR-BOY
        </div>
      </div>
      
      <!-- Mini Underwater Screen -->
      <div class="mini-underwater-screen absolute top-3 left-2 right-2 bottom-4 rounded-sm overflow-hidden">
        <div class="holo-underwater-screen h-full relative">
          {% if user.is_authenticated %}
            <!-- Mini Turtle Avatar -->
            <img src="/media/defaults/turtle_sunbathing.gif" 
                class="mini-turtle-avatar w-3 h-3 absolute top-1 left-1"
                style="image-rendering: pixelated;">
            
            <!-- Mini Underwater Elements -->
            <div class="mini-coral absolute bottom-0 right-1 text-[6px] opacity-60">ðŸª¸</div>
            <div class="mini-kelp absolute top-0 right-0 text-[6px] opacity-60">ðŸŒ¿</div>
            
            <!-- Mini Bubble -->
            <div class="mini-bubble absolute top-2 right-2 w-1 h-1 rounded-full border border-blue-400 opacity-40"></div>
          {% else %}
            <!-- Not Connected State -->
            <div class="flex justify-center items-center h-full">
              <img class="w-2 h-2" src="/media/defaults/red_dots.gif" alt="Disconnected">
            </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Mini Status Indicators -->
      <div class="mini-status-dots absolute bottom-1 left-1 right-1 flex justify-center gap-0.5">
        {% if user.is_authenticated %}
          <div class="status-dot-active w-1 h-1 rounded-full bg-cyan-400" 
              style="box-shadow: 0 0 2px currentColor;"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
        {% else %}
          <div class="status-dot w-1 h-1 rounded-full bg-red-500 opacity-60"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
          <div class="status-dot w-1 h-1 rounded-full bg-gray-600 opacity-40"></div>
        {% endif %}
      </div>
    </div>
    
    <!-- Floating Animation Glow Ring -->
    <div class="console-glow-ring"></div>
  </div> <!-- ENd of Floating Mini Turboy Console  -->


  <!-- Full turboy -->
  <div
    x-show="showTurboy" 
    x-cloak
    class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50"
    @keydown.escape.window="closeFullTurboy"
  >
    <div
      x-data="{ onListPage: false }" 
      class="py-4 xs:px-4 md:px-12 mx-auto max-w-2xl overflow-y-hidden">

      {% include 'posts/partial/turboy.html' with in_modal=True %}
    </div>
  </div>   <!-- End of full turboy -->


</div> <!-- End of mini & full turboy container -->






<!-- All styles now handled by holographic console components in layout.css -->
