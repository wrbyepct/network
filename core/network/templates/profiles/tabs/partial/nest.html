<!-- Turtle Nest Collection Page - Phase 1 Implementation -->
<div class="min-h-screen bg-gradient-to-b from-blue-50 to-green-50 p-6">
  <div class="max-w-6xl mx-auto">
    
    <!-- Page Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-green-800 mb-2 font-mono">üê¢ Your Turtle Sanctuary üê¢</h1>
      <p class="text-green-600">Explore your egg collection and check your nest</p>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
      
      <!-- Left Side - Egg Collection Museum -->
      <div class="flex-1 bg-amber-50 border-4 border-amber-600 rounded-xl p-6 shadow-[8px_8px_0px_#d97706]">
        <div class="flex items-center mb-6">
          <h2 class="text-2xl font-bold text-amber-800 font-mono">Egg Collection</h2>
        </div>

        <!-- Django Template Loop Implementation -->
        {% if eggs %}
          <div class="space-y-6">
            {% for egg_type in eggs %}
              <div class="egg-type-section">
                <div class="flex items-center mb-4">
                  {% if egg_type.name == 'special' %}
                    <h class="text-xl font-semibold text-purple-700">Legendary Eggs:</h3>
                  {% else %}
                    <h3 class="text-xl font-semibold text-amber-700">Cute Eggs:</h3>
                  {% endif %}
                </div>
                
                {% if egg_type.eggs %}
                  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    {% for egg in egg_type.eggs %}
                      <div class="{% if egg_type.name == 'special' %}bg-gradient-to-br from-purple-100 to-indigo-100 border-3 border-purple-500{% else %}bg-white border-3 border-amber-500{% endif %} rounded-lg p-4 hover:shadow-lg hover:scale-105 transition-all duration-200 cursor-pointer group relative overflow-hidden">
                        
                        {% if egg_type.name == 'special' %}
                          <!-- Magical glow effect for special eggs -->
                          <div class="absolute inset-0 bg-gradient-to-r from-purple-400/10 to-indigo-400/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        {% endif %}
                        
                        <div class="relative flex items-center justify-between">
                          <span class="font-medium {% if egg_type.name == 'special' %}text-purple-800 group-hover:text-purple-900{% else %}text-amber-800 group-hover:text-amber-900{% endif %}">
                            {{ egg.name|title }}
                          </span>
                          <div class="flex items-center">
                            <div class="relative">
                              <img class="w-12 h-12 pixel-art-egg {% if egg_type.name == 'special' %}special-egg-glow{% endif %}" 
                                   src="{{ egg.url }}" 
                                   alt="{{ egg.name|title }}">
                              <div class="absolute inset-0 rounded-full {% if egg_type.name == 'special' %}bg-purple-300{% else %}bg-green-200{% endif %} opacity-0 group-hover:opacity-30 transition-opacity duration-200"></div>
                            </div>
                            <span class="{% if egg_type.name == 'special' %}bg-gradient-to-r from-purple-200 to-indigo-200 text-purple-800 border-2 border-purple-400{% else %}bg-amber-200 text-amber-800 border-2 border-amber-400{% endif %} px-2 py-1 rounded-full text-sm font-bold">
                              √ó {{ egg.quantity }}
                            </span>
                          </div>
                        </div>
                      </div>
                    {% endfor %}
                  </div>
                {% else %}
                  <!-- Empty state for this egg type -->
                  <div class="text-center py-8 {% if egg_type.name == 'special' %}bg-purple-50 border-2 border-purple-200{% else %}bg-amber-50 border-2 border-amber-200{% endif %} rounded-lg border-dashed">
                    <div class="mb-3">
                      <span class="text-4xl">üê¢</span>
                    </div>
                    <p class="{% if egg_type.name == 'special' %}text-purple-600{% else %}text-amber-600{% endif %} text-sm">
                      No {{ egg_type.name }} eggs yet!
                    </p>
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        {% else %}
          <!-- Global empty state when no eggs at all -->
          <div class="text-center py-12">
            <div class="mb-4">
              <span class="text-6xl">üê¢</span>
            </div>
            <h3 class="text-xl font-semibold text-amber-700 mb-2">No Eggs Yet!</h3>
            <p class="text-amber-600 mb-4">Your collection is waiting for the first magical egg...</p>
            <div class="text-sm text-amber-500">
              üí° Create posts to discover eggs in your journey!
            </div>
          </div>
        {% endif %}
      </div>

      <!-- Right Side - Sacred Nesting Grounds -->
      <div class="flex-1">
        <div class="bg-green-50 border-4 border-green-600 rounded-xl p-6 shadow-[8px_8px_0px_#16a34a] min-h-96"
             x-data="{ 
               isIncubating: {{ is_incubating|yesno:'true,false' }},
               postHatched: false,
               onListPage: false,
               hatchedPostId: null
             }">
          
          <!-- Nest Title -->
          <div class="text-center mb-6">
            <div class="flex items-center justify-center mb-2">
              <h2 class="text-2xl font-bold text-green-800 font-mono">{{ profile.username }}'s Nest</h2>
            </div>
          </div>

          <!-- Nest Container -->
          <div class="flex flex-col items-center justify-center relative">
            
            

            <!-- Incubating State -->
            <div x-show="!postHatched"
                 x-transition:enter="transition ease-out duration-500"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 class="text-center">
              
              <!-- Enchanted Crystal Terrarium -->
              <div class="relative mb-6">
                
                <!-- Crystal Dome Container -->
                <div class="relative w-70 h-70 mx-auto">
                  
                  <!-- Main Crystal Dome -->
                  <div class="w-full h-full rounded-full bg-gradient-to-br from-cyan-100/30 via-blue-100/20 to-purple-100/30 border-2 border-cyan-200/50 backdrop-blur-sm relative overflow-hidden crystal-dome shadow-2xl relative">
                    
                    <!-- Iridescent Reflection Effect -->
                    <div class="absolute inset-0 rounded-full bg-gradient-to-r from-pink-200/20 via-purple-200/20 via-blue-200/20 via-green-200/20 to-yellow-200/20 aurora-shift opacity-60"></div>
                    
                    <!-- Inner Glass Layer -->
                    <div class="absolute inset-3 rounded-full border border-white/30 backdrop-blur-xs"></div>
                    
                    <!-- Floating Energy Particles -->
                    <div class="absolute top-4 left-6 w-1 h-1 bg-cyan-400 rounded-full particle-float animate-ping"></div>
                    <div class="absolute top-8 right-8 w-1.5 h-1.5 bg-purple-400 rounded-full particle-float animate-ping" style="animation-delay: 1s;"></div>
                    <div class="absolute bottom-6 left-8 w-1 h-1 bg-pink-400 rounded-full particle-float animate-ping" style="animation-delay: 2s;"></div>
                    <div class="absolute bottom-8 right-6 w-0.5 h-0.5 bg-blue-400 rounded-full particle-float animate-ping" style="animation-delay: 3s;"></div>
                    <div class="absolute top-1/3 left-4 w-1 h-1 bg-green-400 rounded-full particle-float animate-ping" style="animation-delay: 1.5s;"></div>
                    <div class="absolute top-2/3 right-4 w-1 h-1 bg-yellow-400 rounded-full particle-float animate-ping" style="animation-delay: 2.5s;"></div>
                    
                    <!-- Floating Crystal Pedestal -->
                    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2">
                      <div class="w-12 h-8 bg-gradient-to-t from-cyan-200/60 to-transparent crystal-pedestal relative">
                        <!-- Crystal facets -->
                        <div class="absolute inset-0 bg-gradient-to-br from-white/40 to-transparent"></div>
                        <div class="absolute top-0 left-0 w-3 h-full bg-gradient-to-r from-white/20 to-transparent"></div>
                        <div class="absolute top-0 right-0 w-3 h-full bg-gradient-to-l from-white/20 to-transparent"></div>
                      </div>
                    </div>
                    
                    <!-- The Incubating Egg - Floating -->
                    <div 
                        id="egg-nest"
                        class="absolute w-full top-3/7 left-1/2 transform egg-levitation text-center"
                        x-effect="if(isIncubating) { console.log('Yes it is incubating'); $nextTick(() => $dispatch('egg-fetch-ready')) }"
                        x-init="htmx.process($el)"
                        hx-get="{% url 'egg' %}"
                        hx-trigger="egg-fetch-ready"
                        hx-target="#egg-nest"
                        hx-swap="innerHTML"
                        
                      >
                      <img class="w-40 h-40 filter drop-shadow-lg mx-auto" 
                           src="data:image/svg+xml,%3Csvg width='48' height='48' viewBox='0 0 48 48' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cellipse cx='24' cy='26' rx='12' ry='16' fill='%23fef3c7'/%3E%3Cellipse cx='24' cy='26' rx='8' ry='12' fill='%23fde047'/%3E%3C/svg%3E" 
                           alt="Incubating Egg">
                      <!-- Egg Glow Aura -->
                      <div class="absolute inset-0 rounded-full bg-yellow-300/30 blur-lg egg-aura"></div>
                    </div>
                    
                    <!-- Energy Tendrils connecting egg to walls -->
                    <div class="absolute top-1/2 left-4 w-12 h-0.5 bg-gradient-to-r from-cyan-400/60 to-transparent energy-tendril"></div>
                    <div class="absolute top-1/2 right-4 w-12 h-0.5 bg-gradient-to-l from-purple-400/60 to-transparent energy-tendril" style="animation-delay: 0.5s;"></div>
                    <div class="absolute top-6 left-1/2 transform -translate-x-1/2 w-0.5 h-12 bg-gradient-to-b from-blue-400/60 to-transparent energy-tendril" style="animation-delay: 1s;"></div>
                    <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 w-0.5 h-12 bg-gradient-to-t from-green-400/60 to-transparent energy-tendril" style="animation-delay: 1.5s;"></div>
                  </div>
                  
                  <!-- Crystal Formation Base -->
                  <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 w-24 h-8">
                    <!-- Main crystal base -->
                    <div class="w-full h-full bg-gradient-to-t from-cyan-300/80 via-cyan-200/60 to-transparent crystal-base relative">
                      <!-- Crystal facets -->
                      <div class="absolute inset-0 bg-gradient-to-br from-white/30 to-transparent"></div>
                      <!-- Crystal edges -->
                      <div class="absolute top-0 left-2 w-1 h-full bg-white/40"></div>
                      <div class="absolute top-0 right-2 w-1 h-full bg-white/40"></div>
                    </div>
                    
                    <!-- Runic Tech Symbols around base -->
                    <div class="absolute -top-2 -left-8 text-cyan-400 text-sm runic-glow opacity-70">‚óä</div>
                    <div class="absolute -top-1 -right-8 text-purple-400 text-sm runic-glow opacity-70" style="animation-delay: 1s;">‚óÜ</div>
                    <div class="absolute -bottom-1 -left-6 text-blue-400 text-xs runic-glow opacity-70" style="animation-delay: 2s;">‚ñ≤</div>
                    <div class="absolute -bottom-1 -right-6 text-green-400 text-xs runic-glow opacity-70" style="animation-delay: 3s;">‚óè</div>
                  </div>
                </div>
              
              </div>
              
              <h3 class="text-lg font-semibold text-cyan-700 my-2">üîÆ Mystical Incubation üîÆ</h3>
              <p class="text-cyan-600 text-sm mb-4">Ancient crystal energy nurtures your precious egg...</p>
              
        </div>
         <!-- Post Hatched State -->
          <div 
            @post-hatched.window="postHatched = true; hatchedPostId = $event.detail.postId"
            x-show="postHatched"
            x-cloak
            x-transition:enter="transition ease-out duration-800 transform"
            x-transition:enter-start="opacity-0 scale-90 rotate-12"
            x-transition:enter-end="opacity-100 scale-100 rotate-0"
            class="text-center">
            
            <!-- Celebration Scene -->
            <div class="flex justify-center items-center mb-6">
              <!-- Excited turtle -->
              <div class="mx-2">
                <span class="text-3xl animate-bounce">üê¢</span>
              </div>
              <!-- Celebration particles -->
              <div class="mx-2">
                <span class="text-2xl animate-ping">üéâ</span>
              </div>
            </div>
            
            <h3 class="text-xl font-bold text-green-700 mb-3">üéä Your Turtle Hatched! üéä</h3>
            <p class="text-green-600 mb-6">Congratulations! Your patience has been rewarded.</p>
            
            <a 
              :href="`{% url 'index' %}#${hatchedPostId}`"
              class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-3 px-6 rounded-lg hover:from-green-600 hover:to-emerald-700 transform hover:scale-105 transition-all duration-200 shadow-[4px_4px_0px_#16a34a]"
              style="text-decoration: none;"
            >
              üê¢ Shut up and show me my turle üê¢
            </a>
          </div>

        </div>

      </div>

    </div>
  </div>
</div>

<!-- Custom Styles -->
<style>
/* Pixel Art Egg Styling */
.pixel-art-egg {
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* Special Egg Glow Effect */
.special-egg-glow {
  animation: special-egg-pulse 2s ease-in-out infinite alternate;
  filter: drop-shadow(0 0 8px rgba(147, 51, 234, 0.4));
}

@keyframes special-egg-pulse {
  0% { 
    filter: drop-shadow(0 0 8px rgba(147, 51, 234, 0.4)); 
    transform: scale(1);
  }
  100% { 
    filter: drop-shadow(0 0 12px rgba(99, 102, 241, 0.6)); 
    transform: scale(1.05);
  }
}

/* Crystal Dome Effects */
.crystal-dome {
  background: 
    radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
    radial-gradient(circle at 70% 70%, rgba(147, 197, 253, 0.2) 0%, transparent 50%),
    linear-gradient(135deg, rgba(219, 234, 254, 0.1) 0%, rgba(196, 181, 253, 0.1) 100%);
  backdrop-filter: blur(8px);
  border: 2px solid rgba(147, 197, 253, 0.3);
  box-shadow: 
    0 0 30px rgba(56, 189, 248, 0.2),
    inset 0 0 20px rgba(255, 255, 255, 0.1);
}

/* Aurora Color Shifting Effect */
.aurora-shift {
  animation: aurora-flow 8s ease-in-out infinite;
}

@keyframes aurora-flow {
  0%, 100% { 
    background: linear-gradient(45deg, 
      rgba(251, 207, 232, 0.2) 0%, 
      rgba(196, 181, 253, 0.2) 25%, 
      rgba(147, 197, 253, 0.2) 50%, 
      rgba(134, 239, 172, 0.2) 75%, 
      rgba(254, 240, 138, 0.2) 100%);
  }
  50% { 
    background: linear-gradient(225deg, 
      rgba(254, 240, 138, 0.2) 0%, 
      rgba(134, 239, 172, 0.2) 25%, 
      rgba(147, 197, 253, 0.2) 50%, 
      rgba(196, 181, 253, 0.2) 75%, 
      rgba(251, 207, 232, 0.2) 100%);
  }
}

/* Floating Particle Effects */
.particle-float {
  animation: particle-dance 4s ease-in-out infinite;
}

@keyframes particle-dance {
  0%, 100% { 
    transform: translate(0, 0) scale(1); 
    opacity: 0.8;
  }
  25% { 
    transform: translate(4px, -6px) scale(1.2); 
    opacity: 1;
  }
  50% { 
    transform: translate(-2px, -8px) scale(0.8); 
    opacity: 0.6;
  }
  75% { 
    transform: translate(6px, -4px) scale(1.1); 
    opacity: 0.9;
  }
}

/* Egg Levitation Effect */
.egg-levitation {
  animation: egg-float 6s ease-in-out infinite;
}

@keyframes egg-float {
  0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
  50% { transform: translate(-50%, -50%) translateY(-8px); }
}

/* Egg Aura Effect */
.egg-aura {
  animation: aura-pulse 3s ease-in-out infinite alternate;
}

@keyframes aura-pulse {
  0% { 
    transform: scale(1); 
    opacity: 0.3; 
  }
  100% { 
    transform: scale(1.3); 
    opacity: 0.1; 
  }
}

/* Energy Tendrils */
.energy-tendril {
  animation: energy-flow 2s ease-in-out infinite;
}

@keyframes energy-flow {
  0%, 100% { 
    opacity: 0.3; 
    transform: scaleX(1);
  }
  50% { 
    opacity: 0.8; 
    transform: scaleX(1.2);
  }
}

/* Crystal Base and Pedestal */
.crystal-base, .crystal-pedestal {
  background: 
    linear-gradient(135deg, rgba(165, 243, 252, 0.6) 0%, rgba(103, 232, 249, 0.4) 100%);
  box-shadow: 
    0 4px 15px rgba(56, 189, 248, 0.2),
    inset 0 2px 10px rgba(255, 255, 255, 0.3);
}

/* Runic Symbols Glow */
.runic-glow {
  animation: rune-pulse 4s ease-in-out infinite;
  text-shadow: 0 0 10px currentColor;
}

@keyframes rune-pulse {
  0%, 100% { 
    opacity: 0.4; 
    transform: scale(1);
  }
  50% { 
    opacity: 1; 
    transform: scale(1.1);
  }
}




@keyframes shimmer-move {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(100%); }
}

/* Hover effect for egg cards */
.egg-type-section .group:hover .pixel-art-egg {
  animation: egg-bob 0.6s ease-in-out;
}

@keyframes egg-bob {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .flex-col.lg\\:flex-row {
    flex-direction: column;
  }
}

/* Button press effect */
button:active {
  transform: scale(0.98);
}


</style>
