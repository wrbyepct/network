<!-- Special Egg Modal - Turtle Community Celebration -->
<div 
    id="egg-modal-content"
    x-data="{
        celebrationPhase: 1,
        maxPhases: 5,
        dialogues: [
            'Wait... is that...?',
            'Could it be...?', 
            'A LEGENDARY EGG!'
        ],
        showConfetti: false,
        currentDialogue: 0,
        autoAdvanceTimer: null,
        
        nextPhase() {
            if (this.celebrationPhase < this.maxPhases) {
                this.celebrationPhase++;
                if (this.celebrationPhase === 2) {
                    this.startDialogueSequence();
                }
            }
        },
        
        startDialogueSequence() {
            this.autoAdvanceTimer = setInterval(() => {
                if (this.currentDialogue < this.dialogues.length - 1) {
                    this.currentDialogue++;
                    this.celebrationPhase++;
                } else {
                    clearInterval(this.autoAdvanceTimer);
                    setTimeout(() => this.nextPhase(), 1000);
                }
            }, 2000);
        },
        
        triggerConfetti() {
            this.showConfetti = true;
            setTimeout(() => this.showConfetti = false, 3000);
        },
        
        closeModal() {
            if (this.autoAdvanceTimer) clearInterval(this.autoAdvanceTimer);
            $parent.showModal = false;
        }
    }"
    class="relative">


    <!-- Main Modal Content -->
    <div class="relative bg-gradient-to-br from-purple-100 via-indigo-50 to-blue-100 border-4 border-purple-800 rounded-lg p-8 pb-0 shadow-[8px_8px_0px_#4c1d95] max-w-sm w-full text-center overflow-hidden">
        
        <!-- Confetti Container -->
        <div x-show="showConfetti" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:leave="transition ease-in duration-1000"
             class="absolute inset-0 pointer-events-none z-50">
            <!-- CSS Confetti Elements -->
            <div class="confetti-piece absolute top-0 left-1/4 w-2 h-2 bg-yellow-400 confetti-fall"></div>
            <div class="confetti-piece absolute top-0 left-1/2 w-2 h-2 bg-pink-400 confetti-fall" style="animation-delay: 0.2s;"></div>
            <div class="confetti-piece absolute top-0 left-3/4 w-2 h-2 bg-blue-400 confetti-fall" style="animation-delay: 0.4s;"></div>
            <div class="confetti-piece absolute top-0 left-1/3 w-2 h-2 bg-green-400 confetti-fall" style="animation-delay: 0.6s;"></div>
            <div class="confetti-piece absolute top-0 right-1/4 w-2 h-2 bg-red-400 confetti-fall" style="animation-delay: 0.8s;"></div>
        </div>

        <!-- Phase 1: Surprised Turtle Entrance -->
        <div x-show="celebrationPhase === 1" 
             x-transition:enter="transition ease-out duration-1000 transform"
             x-transition:enter-start="opacity-0 translate-y-20 scale-50"
             x-transition:enter-end="opacity-100 translate-y-0 scale-100"
             class="mb-6">
            <div class="relative inline-block">
                <img src="/media/defaults/surprised_turtle.png" 
                     alt="Surprised Turtle" 
                     class="w-24 h-24 mx-auto turtle-surprise-entrance"
                     @animationend="setTimeout(() => nextPhase(), 500)">
                <!-- Surprise lines around turtle -->
                <div class="absolute -top-2 -left-2 text-yellow-500 text-xl animate-pulse">✨</div>
                <div class="absolute -top-2 -right-2 text-yellow-500 text-xl animate-pulse" style="animation-delay: 0.3s;">✨</div>
                <div class="absolute -bottom-2 -left-2 text-yellow-500 text-xl animate-pulse" style="animation-delay: 0.6s;">✨</div>
                <div class="absolute -bottom-2 -right-2 text-yellow-500 text-xl animate-pulse" style="animation-delay: 0.9s;">✨</div>
            </div>
        </div>

        <!-- Phase 2-4: Dialogue Sequence -->
        <div x-show="celebrationPhase >= 2 && celebrationPhase <= 4" 
             x-transition:enter="transition ease-out duration-500"
             x-transition:enter-start="opacity-0 scale-90"
             x-transition:enter-end="opacity-100 scale-100"
             class="mb-6">
            
            
            
            <!-- Speech Bubble -->
            <div class="relative bg-white border-4 border-purple-700 rounded-3xl p-4 mb-4 speech-bubble transform">
                <p class="font-bold" 
                   :class="currentDialogue === 2 ? 'text-yellow-400 text-2xl' : 'text-purple-900 text-lg' "
                   x-text="dialogues[currentDialogue] || 'Something amazing is happening!'"></p>
                
                <!-- Speech bubble tail -->
                <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"></div>
                <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-5 border-r-5 border-t-5 border-transparent border-t-purple-700"></div>
            </div>
            
            <!-- Excited Turtle -->
            <div class="relative inline-block mb-4">
                <img src="/media/defaults/surprised_turtle.png" 
                     alt="Excited Turtle" 
                     class="w-20 h-20 mx-auto turtle-excited animate-bounce">
            </div>
        </div>

        <!-- Phase 5: Final Celebration & Interaction -->
        <div x-show="celebrationPhase === 5" 
             @transitionstart="triggerConfetti()"
             x-transition:enter="transition ease-out duration-800 transform"
             x-transition:enter-start="opacity-0 translate-y-10 scale-95"
             x-transition:enter-end="opacity-100 translate-y-0 scale-100">
            
            <!-- Title -->
            <div class="mb-6">
                <h3 class="text-3xl font-bold text-purple-900 mb-2 font-mono animate-pulse">LEGENDARY EGG!</h3>
                <div class="flex justify-center items-center space-x-2 mb-4">
                    <img class="w-7 h-auto" src="/media/defaults/impressed.png" alt="Impressed Turtle">
                    <div class="text-purple-800 font-semibold">The Turtle Council is impressed!</div>
                    <img class="w-7 h-auto" src="/media/defaults/impressed.png" alt="Impressed Turtle">
                </div>
            </div>


            <!-- Special Egg Display -->
            <div class="mb-6">
                <div class="relative inline-block">
                    <img src="{{ egg_url }}" 
                         alt="Legendary Pixel Egg" 
                         class="w-60 h-auto mx-auto special-egg-glow">
                    <!-- Magical aura rings -->
                    <div class="absolute inset-0 rounded-full border-2 border-purple-400 border-opacity-50 animate-ping"></div>
                    <div class="absolute inset-0 rounded-full border-2 border-blue-400 border-opacity-50 animate-ping" style="animation-delay: 0.5s;"></div>
                </div>
                
                <!-- Rarity Indicator -->
                <div class="mt-4 inline-block bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg">
                    ✨ This egg... Is rare!! ✨
                </div>
            </div>


            
        </div>

        <!-- Action Button -->
        <button
            class="w-full font-bold py-4 px-6 mb-5 rounded-lg focus:outline-none focus:ring-4 transition duration-150 ease-in-out shadow-[4px_4px_0px_#4c1d95] transform hover:scale-105"
            :class="celebrationPhase === 5 ? 'bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 focus:ring-purple-300' : 'bg-purple-200 text-purple-800 hover:bg-purple-300 focus:ring-purple-300'"
            @click="showModal = false"
            x-show="celebrationPhase === 5"
            x-cloak
        >Magnificent!
        </button>
    </div>
    
    <!-- Custom Animation Styles -->
    <style>
/* Turtle Entrance Animation */
.turtle-surprise-entrance {
    animation: surprise-bounce 1.2s ease-out forwards;
}

@keyframes surprise-bounce {
    0% { transform: translateY(100px) scale(0.5); opacity: 0; }
    60% { transform: translateY(-20px) scale(1.1); }
    100% { transform: translateY(0) scale(1); opacity: 1; }
}

/* Excited Turtle Animation */
.turtle-excited {
    animation: excited-wiggle 0.8s ease-in-out infinite;
}

@keyframes excited-wiggle {
    0%, 100% { transform: rotate(-3deg); }
    50% { transform: rotate(3deg); }
}

/* Speech Bubble Pop Animation */
.speech-bubble {
    animation: bubble-pop 0.6s ease-out;
}

@keyframes bubble-pop {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
}


/* Special Egg Glow */
.special-egg-glow {
    animation: mystical-pulse 2s ease-in-out infinite alternate;
    filter: drop-shadow(0 0 20px rgba(147, 51, 234, 0.7));
}

@keyframes mystical-pulse {
    0% { filter: drop-shadow(0 0 20px rgba(147, 51, 234, 0.7)); }
    100% { filter: drop-shadow(0 0 30px rgba(99, 102, 241, 0.9)); }
}


/* Confetti Animation */
.confetti-fall {
    animation: confetti-drop 3s ease-out infinite;
}

@keyframes confetti-drop {
    0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
    100% { transform: translateY(400px) rotate(360deg); opacity: 0; }
}



@keyframes celebration-bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}
</style>
</div>
