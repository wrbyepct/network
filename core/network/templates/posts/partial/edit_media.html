<div
  x-data="{
    toUploadMedia: { 
      images: [],
      videos: [],
    },
    addMedia(file, type) {
        this.selectedMedia[type].push({ 
            file: file, 
            url: URL.createObjectURL(file),
            type: type
        });
    },
    removeOldMedia(id) {
      this.toDeleteIds.push(id);
      console.log(`Media ${id} deleted`);
    },
    removeMedia(index, type) {
        // This is to clean up memory
        URL.revokeObjectURL(this.selectedMedia[type][index].url); 

        this.selectedMedia[type].splice(index, 1);
    },
    handleMediaUpload(event) {
      const files = Array.from(event.target.files);
      files.forEach(file => {
          if (file.type.startsWith('image/')) this.addMedia(file, 'images');
          if (file.type.startsWith('video/')) this.addMedia(file, 'videos');
      });
    },
    prepareMediaThenSubmit(form) {
      // Put the newest list in media input before submit
      const imageTransfer = new DataTransfer();
      this.selectedMedia.images.forEach( image => imageTransfer.items.add(image.file));
      this.$refs.imageInput.files = imageTransfer.files;

      const videoTransfer = new DataTransfer();
      this.selectedMedia.videos.forEach( video => videoTransfer.items.add(video.file));
      this.$refs.videoInput.files = videoTransfer.files;
    },
    toDeleteIds: [],
  }"
>
    
    <!-- Logic to collect new media files -->
    <!-- Display the same layout but with cancel buttom on the top right -->
    {% include 'posts/partial/media_gallery.html' with editing=True %}

</div>
