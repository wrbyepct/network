{% extends 'network/layout.html' %} 
{% load post_extra %}
{% block body %}
  <div x-data="{ 
    isPostDetail: false, 
    showCreatePostModal: false,
    isIncubating: {{ is_incubating|yesno:'true,false' }},
    onListPage: true
  }" > 
    <div class="container-fluid mt-4">
      <div class="row">
        <!-- Pond Panel (Left Sidebar) -->
        <div class="col-lg-3 d-none d-lg-block">
          <div class="pond-status-screen sticky top-5">
            <!-- Header (Game UI Style) -->
            <div class="pond-screen-header">
              <span class="pond-screen-title">üåä THE POND</span>
            </div>
            
            <!-- Content -->
            <div class="pond-screen-content">
              <!-- Following Stats -->
              <div class="pond-stat-block">
                <div class="pond-stat-label">
                  <img src="/static/network/media/defaults/turtle_following.png" alt="Following" class="w-4 h-4 mr-1">
                  FOLLOWING
                </div>
                <div class="pond-counter">{{ user.profile.following.count|stringformat:"03d" }}</div>
                <a href="{% url 'profile_about' user.profile.username %}" class="pond-btn">VIEW</a>
              </div>

              <!-- Followers Stats -->
              <div class="pond-stat-block">
                <div class="pond-stat-label">
                  <img src="/static/network/media/defaults/turtle_followers.png" alt="Followers" class="w-4 h-4 mr-1">
                  FOLLOWERS
                </div>
                <div class="pond-counter">{{ user.profile.followers.count|stringformat:"03d" }}</div>
                <a href="{% url 'profile_about' user.profile.username %}" class="pond-btn">VIEW</a>
              </div>

              <!-- Recent Followers -->
              {% if user.profile.followers.exists %}
                <div class="pond-stat-block">
                  <div class="pond-stat-label">RECENT FRIENDS</div>
                  <div class="pond-avatars">
                    {% for follower in user.profile.followers.all|slice:":4" %}
                      <a href="{% url 'profile_about' follower.username %}" 
                         class="pond-avatar-pixel" 
                         title="{{ follower.username }}">
                        <img src="{{ follower.profile_picture.url }}" alt="{{ follower.username }}">
                      </a>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-lg-6">

          <!-- List page egg container -->
          <div 
            id="incubating-egg-container"
            hx-get="{% url 'egg' %}"
            hx-trigger="egg-fetch-ready"
            hx-swap="innerHTML"
            x-ref="eggDiv"
            x-effect="if(isIncubating) $nextTick(() => $dispatch('egg-fetch-ready'))"
            @post-created.window="isIncubating = true"
            {# Error means the post has hatched, just refresh the page #}
            @htmx:response-error="window.location.href = '/'"
          ></div>

          <div x-show="!isIncubating" class="mb-4">
             {% include 'posts/partial/post_composer.html' %}
          </div>
          
          <div 
            id="published-posts" 
            class="grid grid-cols-1 gap-4"
          >
            

            {% for post in posts %}
                {% include 'posts/post/list_card.html' %}
            {% empty %}
              <p class="text-center text-muted">No turties yet... Let's hatch One!</p>
            {% endfor %}
          </div>
        </div>

        <!-- Right Sidebar (Future expansion) -->
        <div class="col-lg-3 d-none d-lg-block">
          <!-- Space for future widgets -->
        </div>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center items-center space-x-3 py-6"
          style="font-family: 'Press Start 2P', monospace; font-size: 10px;">

        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}"
            class="text-decoration-none pixel-btn bg-green-400 border-4 border-green-800 !text-stone-900 px-4 py-2
                    rounded-md shadow-[4px_4px_0px_#3B3B3B]
                    hover:bg-green-300 hover:-translate-y-1 hover:shadow-[6px_6px_0px_#3B3B3B]
                    active:translate-y-0 transition-all duration-150">
            ‚óÄ PREV
          </a>
        {% endif %}

        <!-- Page Counter -->
        <div class="page-display bg-yellow-200 border-4 border-stone-700 flex items-center gap-2 px-4 py-2">

          <span class="text-stone-700 text-bold">PAGE</span>

          <!-- Current Page (editable egg) -->
          <div x-data="{ 
                  page: {{ page_obj.number|stringformat:'02d' }},
                  get pageUrl() { return `?page=${this.page}` }
              }"
              class="digit-display bg-green-200 border-4 border-green-700 
                      w-16 h-8 flex items-center justify-center text-green-900 rounded-sm font-bold relative">

            <input class="absolute inset-0 bg-transparent text-center border-none font-bold rounded-sm"
                  type="text"
                  :value="page"
                  x-model="page"
                  @keydown.enter="window.location.href = pageUrl">
          </div>

          <span class="text-stone-700">/</span>

          <!-- Total Pages (stone egg) -->
          <div class="digit-display bg-amber-200 border-4 border-amber-500 rounded-sm
                      w-16 h-8 flex items-center justify-center text-stone-800 font-semibold">
            {{ page_obj.paginator.num_pages }}
          </div>
        </div>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}"
            class="text-decoration-none pixel-btn bg-green-400 border-4 border-green-800 !text-stone-900 px-4 py-2
                    rounded-md shadow-[4px_4px_0px_#3B3B3B]
                    hover:bg-green-300 hover:-translate-y-1 hover:shadow-[6px_6px_0px_#3B3B3B]
                    active:translate-y-0 transition-all duration-150">
            NEXT ‚ñ∂
          </a>
        {% endif %}
      </div>
    </div>
  </div>

<style>
    /* Turtle Pond Habitat Panel - Matching Site Theme */
    .pond-status-screen {
      background: 
        radial-gradient(ellipse at top, rgba(168, 213, 160, 0.4) 0%, transparent 40%),
        radial-gradient(ellipse at bottom right, rgba(255, 214, 111, 0.3) 0%, transparent 50%),
        linear-gradient(180deg, #A8D5A0 0%, rgba(168, 213, 160, 0.8) 50%, rgba(210, 166, 121, 0.6) 100%);
      border: 4px solid #5D4037;
      border-radius: 8px;
      font-family: 'Press Start 2P', monospace;
      font-size: 8px;
      box-shadow: 4px 4px 0px #3B3B3B;
      overflow: hidden;
      position: sticky;
      top: 20px;
      image-rendering: pixelated;
    }

    /* Subtle habitat texture */
    .pond-status-screen::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3) 1px, transparent 2px),
        radial-gradient(circle at 70% 60%, rgba(255, 255, 255, 0.2) 1px, transparent 2px),
        radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.15) 1px, transparent 2px);
      pointer-events: none;
    }

    .pond-screen-header {
      background: #A8D5A0;
      padding: 10px 14px;
      border-bottom: 3px solid #5D4037;
      position: relative;
      box-shadow: inset 0 2px 0px rgba(255, 255, 255, 0.3);
    }

    /* Turtle friend on header */
    .pond-screen-header::after {
      content: 'üê¢';
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      opacity: 0.8;
      image-rendering: pixelated;
    }

    .pond-screen-title {
      color: #3B3B3B;
      font-weight: bold;
      font-size: 9px;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.5);
    }

    .pond-screen-content {
      padding: 14px;
      background: 
        radial-gradient(ellipse at 25% 25%, rgba(255, 214, 111, 0.2) 0%, transparent 40%),
        radial-gradient(ellipse at 75% 75%, rgba(168, 213, 160, 0.3) 0%, transparent 35%);
      position: relative;
    }

    /* Turtle habitat lily pad stat blocks */
    .pond-stat-block {
      background: #A8D5A0;
      border: 3px solid #5D4037;
      border-radius: 50px 50px 12px 50px; /* lily pad shape */
      margin-bottom: 12px;
      padding: 10px 12px;
      box-shadow: 3px 3px 0px #3B3B3B;
      position: relative;
    }

    /* Small water droplet on lily pads */
    .pond-stat-block::before {
      content: 'üíß';
      position: absolute;
      top: 6px;
      right: 10px;
      font-size: 8px;
      opacity: 0.6;
    }

    .pond-stat-label {
      display: flex;
      align-items: center;
      color: #3B3B3B;
      font-size: 7px;
      font-weight: bold;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.5);
    }

    /* Turtle shell counter displays */
    .pond-counter {
      background: #FFD66F;
      color: #3B3B3B;
      font-family: 'Press Start 2P', monospace;
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      padding: 6px 10px;
      border: 3px solid #D2A679;
      border-radius: 4px;
      margin: 6px 0;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.5);
      box-shadow: 2px 2px 0px #3B3B3B;
    }

    /* Habitat navigation buttons */
    .pond-btn {
      background: #FFD66F;
      color: #3B3B3B;
      border: 2px solid #D2A679;
      border-radius: 4px;
      padding: 3px 8px;
      font-size: 7px;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      cursor: pointer;
      transition: all 0.15s ease;
      text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.5);
      box-shadow: 2px 2px 0px #3B3B3B;
    }

    .pond-btn:hover {
      background: #A8D5A0;
      color: #3B3B3B;
      text-decoration: none;
      transform: translateY(-1px);
      box-shadow: 3px 3px 0px #3B3B3B;
    }

    .pond-btn:active {
      transform: translateY(0px);
      box-shadow: 1px 1px 0px #3B3B3B;
    }

    .pond-avatars {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    /* Turtle friends in habitat */
    .pond-avatar-pixel {
      display: block;
      width: 28px;
      height: 28px;
      border: 3px solid #5D4037;
      border-radius: 50%;
      box-shadow: 2px 2px 0px #3B3B3B;
      overflow: hidden;
      transition: all 0.15s ease;
      position: relative;
      image-rendering: pixelated;
    }

    /* Turtle shell texture effect */
    .pond-avatar-pixel::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      bottom: -1px;
      border: 1px solid rgba(168, 213, 160, 0.6);
      border-radius: 50%;
      opacity: 0;
      transform: scale(1);
      transition: all 0.2s ease;
    }

    .pond-avatar-pixel:hover {
      border-color: #D2A679;
      transform: translateY(-1px) scale(1.05);
      box-shadow: 3px 3px 0px #3B3B3B;
    }

    .pond-avatar-pixel:hover::before {
      opacity: 1;
      transform: scale(1.1);
    }

    .pond-avatar-pixel img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: pixelated;
      filter: contrast(1.1) saturate(1.1) brightness(1.05);
    }

    /* Responsive - hide on smaller screens */
    @media (max-width: 1199px) {
      .pond-status-screen {
        display: none;
      }
    }

    .pixel-btn {
      box-shadow:
        6px 6px 0px rgba(0, 0, 0, 0.3),
        inset 2px 2px 0px rgba(255, 255, 255, 0.2);
      text-decoration: none;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .pixel-btn:hover {
      box-shadow:
        4px 4px 0px rgba(0, 0, 0, 0.3),
        inset 2px 2px 0px rgba(255, 255, 255, 0.3);
    }

    .pixel-btn:active {
      box-shadow:
        2px 2px 0px rgba(0, 0, 0, 0.3),
        inset 1px 1px 0px rgba(0, 0, 0, 0.2);
    }

    .page-display {
      box-shadow:
        inset 4px 4px 0px rgba(0, 0, 0, 0.5),
        2px 2px 0px rgba(255, 255, 255, 0.1);
    }

    .digit-display {
      font-family: 'Courier New', monospace;
      text-shadow: 0 0 4px currentColor;
    }


    /* Mobile responsiveness */
    @media (max-width: 640px) {

      .pixel-btn {
        px-3 py-2;
      }

      .page-display {
        px-4 py-2;
      }
    }
  </style>

{% endblock %}
